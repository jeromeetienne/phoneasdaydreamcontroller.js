<!-- add webvr recorder/player -->
<script src='../vendor/download.js'></script>
<script src='../vendor/cloneObject.js'></script>
<script src='../threex.jsonplayer.js'></script>
<script src='../threex.jsonrecorder.js'></script>

<script src='../threex.webvrrecorder.js'></script>
<script src='../threex.webvrplayer.js'></script>

<h2>Here is the raw webvr api data</h2>
<pre id='output'></pre>
<canvas id='myCanvas'></canvas>
<script>
	var vrDisplay = null
	navigator.getVRDisplays().then(function(displays){
		displays = displays.filter(function(display){
			return display.capabilities.canPresent
		})
		// If there are no devices available, quit out.
		if (displays.length === 0) {
    			console.warn('No devices available able to present.');
			return;
		}

		vrDisplay = displays[0]
		console.dir(vrDisplay)
		vrDisplay.requestPresent([{
			source: document.querySelector('#myCanvas')
		}]);
		
		////////////////////////////////////////////////////////////////////////////////
		//          Code Separator
		////////////////////////////////////////////////////////////////////////////////

		// var mode = 'record'
		var mode = 'play'
		// var mode = ''
window.mode = mode

		if( mode === 'record' ){
			var webvrRecorder = new THREEx.WebvrRecorder().start()
		}

		if( mode === 'play' ){
			var webvrPlayer = THREEx.WebvrPlayer.cookedLoad('data-webvr/webvrrecords', 1, function onLoaded(){
				webvrPlayer.start()
			})
		}
window.webvrPlayer = webvrPlayer
		// vrDisplay.getFrameData = function(frameData){}
		// 				
	})

	var frameData = new VRFrameData();
	function dumpFrameData(){
		if( mode === 'record'){		
			if( vrDisplay === null )	return
			vrDisplay.getFrameData(frameData);
		}else{
			if( webvrPlayer === null )	return
			frameData = webvrPlayer.frameData			
		}


		var text = ''
		text += JSON.stringify(frameData, null, '\t')+'\n'

		var domElement = document.querySelector('#output')
		domElement.innerText = text
		setTimeout(dumpFrameData, 100)
	}
	setTimeout(dumpFrameData, 0)
	

	////////////////////////////////////////////////////////////////////////////////
	//          utils functions
	////////////////////////////////////////////////////////////////////////////////

	function pad(num, size) {
                var s = num + '';
                while (s.length < size) s = '0' + s;
                return s;
        }
</script>
<script>	

</script>
